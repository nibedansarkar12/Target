<!DOCTYPE html><html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Target Zone Mock Tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: radial-gradient(#1e3c72, #2a5298);
      font-family: 'Segoe UI', sans-serif;
      color: white;
      overflow-x: hidden;
    }
    #stars, #planes {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      pointer-events: none;
    }
    .floating-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    #quiz-container input[type="radio"] {
      margin-right: 8px;
    }
    @keyframes bounceIn {
      from {transform: scale(0.5); opacity: 0;}
      to {transform: scale(1); opacity: 1;}
    }
    .animate-bounceIn {
      animation: bounceIn 0.5s ease-out forwards;
    }
  </style>
</head>
<body class="relative min-h-screen overflow-y-auto">
  <canvas id="stars"></canvas>
  <canvas id="planes"></canvas>  <!-- Exam Dashboard -->  <div id="dashboard" class="relative z-10 text-center py-10 px-4">
    <h1 class="text-4xl font-extrabold mb-4 text-white">Target Zone Mock Tests</h1>
    <p class="mb-6 text-gray-200">ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи ржЖржкржирж┐ ржХрзЛржи ржмрж┐рж╖рзЯрзЗрж░ ржкрж░рзАржХрзНрж╖рж╛ ржжрж┐рждрзЗ ржЪрж╛ржи:</p>
    <div id="exam-cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 px-6 max-w-6xl mx-auto pb-24"></div>
  </div>  <!-- Quiz Container -->  <div id="quiz-container" class="hidden max-w-4xl mx-auto bg-white rounded-lg shadow p-6 relative z-10 text-gray-800">
    <h2 id="quiz-header" class="text-2xl font-bold text-center mb-6">Mock Test</h2>
    <div class="flex justify-end mb-4">
      <span id="timer" class="bg-blue-700 text-white px-4 py-1 rounded text-lg font-semibold">80:00</span>
    </div>
    <div class="mb-6">
      <p id="question-text" class="text-lg font-semibold">ржкрзНрж░рж╢рзНржи 1: ржкрзНрж░рж╢рзНржи рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
      <ul id="options-list" class="space-y-3 mt-4"></ul>
    </div>
    <div class="flex justify-center gap-4 mb-6">
      <button id="mark-review-btn" class="bg-yellow-500 text-white px-4 py-2 rounded shadow">ЁЯФЦ ржорж╛рж░рзНржХ ржХрж░рзЗ рж░рж╛ржЦрзЛ</button>
      <button id="prev-btn" class="bg-gray-600 text-white px-4 py-2 rounded shadow">тмЕ ржкрзВрж░рзНржмржмрж░рзНрждрзА</button>
      <button id="next-btn" class="bg-blue-600 text-white px-4 py-2 rounded shadow">ржкрж░ржмрж░рзНрждрзА тЮб</button>
    </div>
    <div id="palette" class="grid grid-cols-8 sm:grid-cols-10 gap-2 justify-center mb-6"></div>
    <div class="flex justify-center mb-6">
      <button id="submit-btn" class="bg-red-600 text-white px-6 py-2 rounded shadow">ЁЯУд ржкрж░рзАржХрзНрж╖рж╛ржЯрж┐ ржЬржорж╛ ржжрж┐ржи</button>
    </div>
    <div class="bg-gray-100 p-4 rounded shadow text-gray-800">
      <h3 class="text-lg font-semibold mb-2">ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛:</h3>
      <p class="text-sm">ЁЯЯв Attempted | ЁЯЯа Review | тЪк Unattempted</p>
    </div>
    <div id="result-box" class="hidden mt-6 bg-green-100 text-green-900 p-4 rounded shadow">
      <h3 class="text-lg font-bold mb-2">ЁЯУК ржкрж░рзАржХрзНрж╖рж╛рж░ ржлрж▓рж╛ржлрж▓</h3>
      <p id="result-text" class="text-md font-semibold"></p>
    </div>
  </div>  <!-- Modal: Result -->  <div id="result-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60">
    <div class="bg-white rounded-lg p-6 w-80 text-center animate-bounceIn">
      <div id="loading-area" class="block">
        <p class="text-xl font-semibold text-gray-800">ЁЯУд ржкрж░рзАржХрзНрж╖рж╛ ржЬржорж╛ рж╣ржЪрзНржЫрзЗ...</p>
        <div class="mt-4 flex justify-center">
          <div class="w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
      </div>
      <div id="final-result" class="hidden">
        <h3 class="text-xl font-bold text-green-700 mb-2">тЬЕ ржкрж░рзАржХрзНрж╖рж╛рж░ ржлрж▓рж╛ржлрж▓</h3>
        <p id="popup-result-text" class="text-gray-800 text-sm leading-relaxed"></p>
        <button onclick="document.getElementById('result-modal').classList.add('hidden')" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded">ржарж┐ржХ ржЖржЫрзЗ</button>
      </div>
    </div>
  </div>  <!-- Modal: Set Selector -->  <div id="set-selector-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60">
    <div class="bg-white p-6 rounded shadow-lg w-80 text-center">
      <h3 class="text-lg font-semibold mb-4">ЁЯЧВя╕П ржПржХржЯрж┐ рж╕рзЗржЯ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</h3>
      <div id="set-options" class="space-y-2"></div>
    </div>
  </div>  <!-- Progress Chart Section -->  <div id="history-section" class="hidden relative z-10 max-w-3xl mx-auto mt-8 bg-white p-4 rounded shadow">
    <h3 class="text-xl font-bold text-center text-gray-800 mb-4">ЁЯУИ ржЖржкржирж╛рж░ ржкрж░рзАржХрзНрж╖рж╛рж░ ржЕржЧрзНрж░ржЧрждрж┐</h3>
    <canvas id="progressChart"></canvas>
  </div>  <footer class="bg-gradient-to-r from-indigo-600 to-purple-600 py-3 text-center text-white text-sm fixed bottom-0 w-full z-10 shadow-lg">
    ЁЯУМ ржЙржирзНржиржд ржкрзНрж░рж╕рзНрждрзБрждрж┐рж░ ржЬржирзНржп тАФ SSC | Railways | TET | WB SET | WBJEE | Madhyamik тАФ рж╕ржм ржХрж┐ржЫрзБ ржПржХ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝
  </footer> <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, collection, getDocs, query, orderBy, addDoc, doc, getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import {
  getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
  authDomain: "target-zone-8fffd.firebaseapp.com",
  projectId: "target-zone-8fffd",
  storageBucket: "target-zone-8fffd.appspot.com",
  messagingSenderId: "667579216123",
  appId: "1:667579216123:web:37bb1fcc724743073d005e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

let currentExam = "", selectedSet = "", userId = "", questions = [], currentQuestion = 0, answers = {}, reviewed = {}, timeLeft = 80 * 60;

onAuthStateChanged(auth, async user => {
  if (user) {
    userId = user.uid;
    document.getElementById("dashboard").classList.remove("hidden");
    await loadProgressChart(userId);
  } else {
    signInWithPopup(auth, provider).catch(err => alert("рж▓ржЧржЗржи ржмрзНржпрж░рзНрже! ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред"));
  }
});

const exams = [
  {id:"ssc", name:"SSC Exams", desc:"CGL, CHSL, GD, MTS"},
  {id:"railways", name:"Railways", desc:"NTPC, Group-D, JE"},
  {id:"tet", name:"TET Exams", desc:"Primary & Upper Primary"},
  {id:"wbset", name:"WB SET", desc:"Paper I & II"},
  {id:"wbjee", name:"WBJEE", desc:"Engineering & Medical"},
  {id:"madhyamik", name:"Madhyamik / HS", desc:"Board MCQ Practice"}
];

const examCards = document.getElementById("exam-cards");
examCards.innerHTML = exams.map(ex => `
  <div class="bg-white text-gray-800 rounded-lg shadow-lg p-5 cursor-pointer transform transition-transform duration-300 hover:scale-105 hover:bg-indigo-100 floating-btn"
       onclick="startExam('${ex.id}', '${ex.name}')">
    <h2 class="text-xl font-bold">${ex.name}</h2>
    <p class="text-sm mt-2 text-gray-600">${ex.desc}</p>
  </div>
`).join("");

window.startExam = async function(examId, examName) {
  currentExam = examId;
  const setSnap = await getDocs(collection(db, `${examId}_sets`));
  const sets = setSnap.docs.map(d => d.id);
  showSetSelector(sets, async (setId) => {
    selectedSet = setId;
    const resultRef = doc(db, `results/${userId}/submissions`, `${currentExam}_${selectedSet}`);
    const existing = await getDoc(resultRef);
    if (existing.exists()) {
      const r = existing.data();
      alert(`тЪая╕П ржЖржкржирж┐ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ${setId} ржжрж┐ржпрж╝рзЗржЫрзЗржиред\nржЖржкржирж╛рж░ рж╕рзНржХрзЛрж░: ${r.score}/${r.total}`);
      return;
    }
    document.getElementById("dashboard").classList.add("hidden");
    document.getElementById("quiz-container").classList.remove("hidden");
    document.getElementById("quiz-header").textContent = `${examName} - ${setId}`;
    await loadQuestions();
  });
}

async function loadQuestions() {
  console.log("ЁЯЪА ржкрзНрж░рж╢рзНржи рж▓рзЛржб рж╢рзБрж░рзБ рж╣ржЪрзНржЫрзЗ...");

  const q = query(
    collection(db, `${currentExam}_sets/${selectedSet}/questions`),
    orderBy("id")
  );

  console.log("ЁЯУВ Path:", `${currentExam}_sets/${selectedSet}/questions`);

  try {
    const snapshot = await getDocs(q);
    console.log("ЁЯУК ржорзЛржЯ ржкрзНрж░рж╢рзНржи ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗ:", snapshot.size);

    questions = snapshot.docs.map(doc => {
      console.log("ЁЯУЭ ржкрзНрж░рж╢рзНржи:", doc.data().question);
      return doc.data();
    });

    if (questions.length === 0) {
      alert("тЪая╕П ржХрзЛржирзЛ ржкрзНрж░рж╢рзНржи ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред");
      return;
    }

    buildPalette();
    showQuestion();
    startTimer();
  } catch (error) {
    console.error("тЭМ ржкрзНрж░рж╢рзНржи рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛:", error);
    alert("ржкрзНрж░рж╢рзНржи рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗред Console check ржХрж░рзБржиред");
  }
  }

function buildPalette() {
  const palette = document.getElementById("palette");
  palette.innerHTML = "";
  for (let i = 0; i < questions.length; i++) {
    const btn = document.createElement("button");
    btn.textContent = i + 1;
    btn.className = "unattempted";
    btn.onclick = () => { currentQuestion = i; showQuestion(); };
    palette.appendChild(btn);
  }
}

function showQuestion() {
  const q = questions[currentQuestion];
  document.getElementById("question-text").textContent = `ржкрзНрж░рж╢рзНржи ${currentQuestion + 1}: ${q.question}`;
  const optionsList = document.getElementById("options-list");
  optionsList.innerHTML = "";
  q.options.forEach(option => {
    const li = document.createElement("li");
    li.classList.add("p-2", "rounded", "border", "cursor-pointer", "hover:bg-gray-100");
    const input = document.createElement("input");
    input.type = "radio";
    input.name = "option";
    input.value = option;
    if (answers[currentQuestion] === option) input.checked = true;
    input.addEventListener("change", () => {
      answers[currentQuestion] = option;
      updatePalette();
    });
    li.appendChild(input);
    li.append(option);
    optionsList.appendChild(li);
  });
  updatePalette();
}

function updatePalette() {
  [...document.getElementById("palette").children].forEach((btn, i) => {
    btn.className = "unattempted";
    if (answers[i]) btn.classList.add("attempted");
    if (reviewed[i]) btn.classList.add("review");
  });
}

function startTimer() {
  setInterval(() => {
    if (timeLeft <= 0) return;
    timeLeft--;
    const min = Math.floor(timeLeft / 60);
    const sec = timeLeft % 60;
    document.getElementById("timer").textContent = `${min}:${sec.toString().padStart(2, "0")}`;
  }, 1000);
}

document.getElementById("prev-btn").onclick = () => {
  if (currentQuestion > 0) currentQuestion--;
  showQuestion();
};
document.getElementById("next-btn").onclick = () => {
  if (currentQuestion < questions.length - 1) currentQuestion++;
  showQuestion();
};
document.getElementById("mark-review-btn").onclick = () => {
  reviewed[currentQuestion] = true;
  updatePalette();
};

document.getElementById("submit-btn").onclick = async () => {
  let correct = 0;
  questions.forEach((q, i) => {
    if (answers[i] === q.answer) correct++;
  });
  const total = questions.length;
  const wrong = Object.keys(answers).length - correct;
  const unattempted = total - Object.keys(answers).length;
  const percent = Math.round((correct / total) * 100);
  showResultPopup(correct, wrong, unattempted, percent);
  await setDoc(doc(db, `results/${userId}/submissions`, `${currentExam}_${selectedSet}`), {
    exam: currentExam,
    set: selectedSet,
    score: correct,
    total,
    correct,
    wrong,
    unattempted,
    submittedAt: new Date()
  });
  await loadProgressChart(userId);
};

function showResultPopup(correct, wrong, unattempted, percent) {
  const modal = document.getElementById("result-modal");
  const loading = document.getElementById("loading-area");
  const final = document.getElementById("final-result");
  const result = document.getElementById("popup-result-text");
  modal.classList.remove("hidden");
  loading.classList.remove("hidden");
  final.classList.add("hidden");
  setTimeout(() => {
    loading.classList.add("hidden");
    final.classList.remove("hidden");
    result.innerHTML = `тЬЕ рж╕ржарж┐ржХ: ${correct}ржЯрж┐<br>тЭМ ржнрзБрж▓: ${wrong}ржЯрж┐<br>тП│ ржирж╛ ржХрж░рж╛: ${unattempted}ржЯрж┐<br>ЁЯУК ржорзЛржЯ рж╕рзНржХрзЛрж░: ${percent}%`;
  }, 1500);
}

function showSetSelector(sets, callback) {
  const modal = document.getElementById("set-selector-modal");
  const container = document.getElementById("set-options");
  modal.classList.remove("hidden");
  container.innerHTML = "";
  sets.forEach(set => {
    const btn = document.createElement("button");
    btn.className = "w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded";
    btn.textContent = set;
    btn.onclick = () => {
      modal.classList.add("hidden");
      callback(set);
    };
    container.appendChild(btn);
  });
}

async function loadProgressChart(userId) {
  const q = query(collection(db, `results/${userId}/submissions`), orderBy("submittedAt"));
  const snapshot = await getDocs(q);
  const data = snapshot.docs.map(doc => doc.data());
  const labels = data.map((d, i) => `Test ${i+1}`);
  const scores = data.map(d => d.score);
  document.getElementById("history-section").classList.remove("hidden");
  new Chart(document.getElementById("progressChart"), {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'рж╕рзНржХрзЛрж░',
        data: scores,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.4,
        fill: false
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}
  </script>
  </body>
</html>
