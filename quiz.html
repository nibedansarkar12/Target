<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Mock Test Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px;
      color: #fff;
    }
    .dashboard, .quiz-container {
      max-width: 800px;
      width: 100%;
      background: white;
      color: #333;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }
    .quiz-container { display: none; }
    .btn {
      background: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      margin: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    .btn:hover { opacity: 0.9; }
    .options li {
      margin-bottom: 12px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
    }
    .options li.correct { background: #d4edda; }
    .options li.wrong { background: #f8d7da; }
    .result-box { margin-top: 20px; padding: 15px; background: #eef3f9; border-radius: 8px; }
  </style>
</head>
<body>
  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <h2>ЁЯОп ржоржХ ржЯрзЗрж╕рзНржЯ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</h2>
    <p id="student-email">рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
    <h3>ржПржХржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:</h3>
    <button class="btn" onclick="startQuiz('wbcs')">WBCS</button>
    <button class="btn" onclick="startQuiz('railways')">Railways</button>
    <button class="btn" onclick="startQuiz('ssc')">SSC</button>
    <button class="btn" onclick="startQuiz('tet')">TET</button>
  </div>

  <!-- Quiz -->
  <div class="quiz-container" id="quiz-container">
    <h2 id="quiz-title"></h2>
    <p id="timer">80:00</p>
    <div class="question-box">
      <div class="question" id="question-text">Loading...</div>
      <ul class="options" id="options-list"></ul>
    </div>
    <button class="btn" id="prev-btn">Prev</button>
    <button class="btn" id="next-btn">Next</button>
    <button class="btn" id="submit-btn">Submit</button>
    <div class="result-box" id="result-box" style="display:none;"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, setDoc, serverTimestamp, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const dashboard = document.getElementById("dashboard");
    const quizContainer = document.getElementById("quiz-container");
    const studentEmail = document.getElementById("student-email");
    const questionText = document.getElementById("question-text");
    const optionsList = document.getElementById("options-list");
    const resultBox = document.getElementById("result-box");
    const quizTitle = document.getElementById("quiz-title");
    const timerElement = document.getElementById("timer");

    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const submitBtn = document.getElementById("submit-btn");

    let questions = [];
    let currentQuestion = 0;
    let answers = {};
    let currentUser = null;
    let selectedExam = "";
    let timeLeft = 80 * 60;
    let timer;

    onAuthStateChanged(auth, user => {
      if (user) {
        studentEmail.textContent = `ЁЯСд ${user.email}`;
        currentUser = user;
      } else {
        alert("ржЖржкржирж┐ рж▓ржЧржЗржи ржХрж░рзЗржиржирж┐!");
        window.location.href = "index.html";
      }
    });

    async function startQuiz(examName) {
      selectedExam = examName;
      quizTitle.textContent = `${examName.toUpperCase()} Mock Test`;
      dashboard.style.display = "none";
      quizContainer.style.display = "block";
      loadQuestions();
    }

    async function loadQuestions() {
      const q = query(collection(db, selectedExam), orderBy("id"));
      const snapshot = await getDocs(q);
      questions = snapshot.docs.map(doc => doc.data());
      showQuestion();
      startTimer();
    }

    function startTimer() {
      timer = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(timer);
          submitQuiz();
        } else {
          timeLeft--;
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, "0")}`;
        }
      }, 1000);
    }

    function showQuestion() {
      const q = questions[currentQuestion];
      if (!q) return;

      questionText.textContent = `ржкрзНрж░рж╢рзНржи ${currentQuestion + 1}: ${q.question}`;
      optionsList.innerHTML = "";

      q.options.forEach((option, idx) => {
        const li = document.createElement("li");
        const input = document.createElement("input");
        input.type = "radio";
        input.name = "option";
        input.value = option;
        if (answers[currentQuestion] === option) input.checked = true;

        input.addEventListener("change", () => {
          answers[currentQuestion] = option;
        });

        li.appendChild(input);
        li.append(option);
        optionsList.appendChild(li);
      });
    }

    prevBtn.addEventListener("click", () => {
      if (currentQuestion > 0) {
        currentQuestion--;
        showQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        showQuestion();
      }
    });

    submitBtn.addEventListener("click", () => {
      submitQuiz();
    });

    async function submitQuiz() {
      clearInterval(timer);
      let correct = 0, wrong = 0, unattempted = 0, score = 0;

      questions.forEach((q, index) => {
        const given = answers[index];
        if (!given) {
          unattempted++;
        } else if (given === q.answer) {
          correct++;
          score += 2;
        } else {
          wrong++;
          score -= 0.25;
        }
      });

      if (currentUser) {
        await setDoc(doc(db, "results", `${currentUser.uid}-${selectedExam}`), {
          exam: selectedExam,
          email: currentUser.email,
          answers: answers,
          correct,
          wrong,
          unattempted,
          score,
          total: questions.length * 2,
          submittedAt: serverTimestamp()
        });
      }

      resultBox.style.display = "block";
      resultBox.innerHTML = `
        <h3>ЁЯУК ржЖржкржирж╛рж░ ржлрж▓рж╛ржлрж▓</h3>
        <p>тЬЕ рж╕ржарж┐ржХ: ${correct}</p>
        <p>тЭМ ржнрзБрж▓: ${wrong}</p>
        <p>тЪк ржЕржирзБрждрзНрждрж░рж┐ржд: ${unattempted}</p>
        <p>ЁЯПЖ ржкрзНрж░рж╛ржкрзНржд ржиржорзНржмрж░: ${score} / ${questions.length * 2}</p>
        <hr>
        <h4>ЁЯФО ржкрзНрж░рж╢рзНржиржнрж┐рждрзНрждрж┐ржХ рж░рж┐ржнрж┐ржЙ</h4>
        ${questions.map((q, i) => `
          <div>
            <b>ржкрзНрж░рж╢рзНржи ${i+1}: ${q.question}</b><br>
            ржЖржкржирж╛рж░ ржЙрждрзНрждрж░: ${answers[i] || "ржжрзЗржУрзЯрж╛ рж╣рзЯржирж┐"}<br>
            рж╕ржарж┐ржХ ржЙрждрзНрждрж░: ${q.answer}
          </div>
          <hr>
        `).join("")}
      `;
    }
  </script>
</body>
</html>
