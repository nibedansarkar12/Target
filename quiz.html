<!-- ‚úÖ Final quiz.html with 9 essential features (excluding multi-language and bookmark) --><!DOCTYPE html><html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Quiz</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; transition: background 0.3s, color 0.3s; }
    .dark-mode { background: #121212; color: white; }
    header { background: #4CAF50; color: white; padding: 10px; text-align: center; position: relative; }
    #timer, #darkToggle { position: absolute; top: 10px; font-size: 14px; }
    #timer { right: 20px; }
    #darkToggle { left: 20px; cursor: pointer; }
    .container { max-width: 800px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .dark-mode .container { background: #1e1e1e; }
    .question { font-weight: bold; margin-bottom: 10px; }
    .options { list-style: none; padding: 0; }
    .options li { margin-bottom: 8px; }
    .palette { display: flex; flex-wrap: wrap; gap: 5px; margin: 15px 0; }
    .palette button { width: 30px; height: 30px; border: none; background: #ccc; cursor: pointer; border-radius: 50%; }
    .palette .attempted { background: #4CAF50; color: white; }
    .palette .review { background: orange; color: white; }
    .progress-bar { background: #ccc; height: 6px; border-radius: 3px; overflow: hidden; margin-bottom: 10px; }
    .progress { background: #4CAF50; width: 0%; height: 100%; }
    .summary { font-size: 14px; margin-bottom: 15px; }
    .flag-btn { font-size: 12px; color: red; cursor: pointer; float: right; }
    .nav-btns { display: flex; justify-content: space-between; margin-top: 20px; }
    button { padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    .submit { background: #e53935; color: white; width: 100%; margin-top: 20px; }
  </style>
</head>
<body oncontextmenu="return false" oncopy="return false" oncut="return false" onpaste="return false">
  <header>
    <div id="darkToggle">üåô</div>
    ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶ï‡ßÅ‡¶á‡¶ú - <span id="student-email">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
    <div id="timer">‚è≥</div>
  </header>
  <div class="container">
    <div class="progress-bar"><div class="progress" id="progress"></div></div>
    <div class="question" id="question-text"></div>
    <ul class="options" id="options-list"></ul>
    <div class="flag-btn" onclick="alert('‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá')">üö© ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
    <div class="nav-btns">
      <button onclick="prevQuestion()">Previous</button>
      <button onclick="markForReview()">Mark for Review</button>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div class="palette" id="question-palette"></div>
    <div class="summary" id="attempt-summary"></div>
    <button class="submit" onclick="confirmSubmit()">Submit</button>
  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      databaseURL: "https://target-zone-8fffd-default-rtdb.firebaseio.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let questions = [];
    let currentQuestion = 0;
    const answers = {};
    const reviewMarked = new Set();
    let currentUser = null;
    let timeLeft = 80 * 60;
    let tabWarnCount = 0;

    onAuthStateChanged(auth, async user => {
      if (user) {
        document.getElementById("student-email").textContent = user.email;
        currentUser = user;
        const resultRef = doc(db, "results", user.uid);
        const resultSnap = await getDoc(resultRef);
        if (resultSnap.exists()) {
          alert("‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!");
          window.location.href = "index.html";
        } else {
          loadQuestions();
          startTimer();
        }
      } else {
        alert("‚ö†Ô∏è ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø");
        window.location.href = "index.html";
      }
    });

    async function loadQuestions() {
      const querySnapshot = await getDocs(collection(db, "questions"));
      questions = querySnapshot.docs.map(doc => doc.data());
      shuffle(questions);
      showQuestion();
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function showQuestion() {
      const q = questions[currentQuestion];
      document.getElementById("question-text").textContent = `‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${currentQuestion + 1}: ${q.question}`;
      const list = document.getElementById("options-list");
      list.innerHTML = "";
      q.options.forEach(opt => {
        const li = document.createElement("li");
        li.innerHTML = `<label><input type='radio' name='opt' value='${opt}' ${answers[currentQuestion] === opt ? 'checked' : ''}> ${opt}</label>`;
        list.appendChild(li);
      });
      updatePalette();
      updateSummary();
      updateProgress();
    }

    function prevQuestion() { if (currentQuestion > 0) currentQuestion--; showQuestion(); }
    function nextQuestion() { if (currentQuestion < questions.length - 1) currentQuestion++; showQuestion(); }
    function markForReview() { reviewMarked.add(currentQuestion); updatePalette(); alert(`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${currentQuestion + 1} ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá`); }

    document.addEventListener('change', e => {
      if (e.target.name === 'opt') {
        answers[currentQuestion] = e.target.value;
        updatePalette();
        updateSummary();
        updateProgress();
      }
    });

    function updatePalette() {
      const palette = document.getElementById("question-palette");
      palette.innerHTML = '';
      for (let i = 0; i < questions.length; i++) {
        const btn = document.createElement("button");
        btn.textContent = i + 1;
        if (answers[i]) btn.classList.add("attempted");
        if (reviewMarked.has(i)) btn.classList.add("review");
        btn.onclick = () => { currentQuestion = i; showQuestion(); };
        palette.appendChild(btn);
      }
    }

    function updateSummary() {
      const attempted = Object.keys(answers).length;
      const skipped = questions.length - attempted;
      const review = reviewMarked.size;
      document.getElementById("attempt-summary").textContent = `Attempted: ${attempted}, Skipped: ${skipped}, Review: ${review}`;
    }

    function updateProgress() {
      const p = document.getElementById("progress");
      const percent = (Object.keys(answers).length / questions.length) * 100;
      p.style.width = `${percent}%`;
    }

    async function confirmSubmit() {
      const total = questions.length;
      let correct = 0;
      let wrong = 0;
      questions.forEach((q, i) => {
        const a = answers[i];
        if (a === undefined) return;
        if (a === q.answer) correct++;
        else wrong++;
      });
      const score = correct * 2 - wrong * 0.25;
      const confirmText = `‚úÖ ‡¶∏‡¶†‡¶ø‡¶ï: ${correct}, ‚ùå ‡¶≠‡ßÅ‡¶≤: ${wrong}, üìà ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score} / ${total * 2}\n\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`;
      if (!confirm(confirmText)) return;
      if (currentUser) {
        const resultRef = doc(db, "results", currentUser.uid);
        await setDoc(resultRef, {
          email: currentUser.email,
          score,
          correct,
          wrong,
          total,
          submittedAt: serverTimestamp(),
          answers
        });
        alert("‚úÖ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶");
        window.location.href = "index.html";
      }
    }

    function startTimer() {
      const t = document.getElementById("timer");
      const interval = setInterval(() => {
        const min = Math.floor(timeLeft / 60);
        const sec = timeLeft % 60;
        t.textContent = `‚è±Ô∏è ${min}:${sec < 10 ? '0' + sec : sec}`;
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(interval);
          alert("üïí ‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑! ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
          confirmSubmit();
        }
      }, 1000);
    }

    document.addEventListener("visibilitychange", () => {
      if (document.hidden) {
        tabWarnCount++;
        alert(`‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ${tabWarnCount} ‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶õ‡ßá‡ßú‡ßá‡¶õ‡ßá‡¶®!`);
        if (tabWarnCount >= 3) confirmSubmit();
      }
    });

    window.onpopstate = () => {
      history.pushState(null, null, window.location.href);
      alert("üîí Back ‡¶¨‡¶æ‡¶ü‡¶® ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    };
    history.pushState(null, null, window.location.href);

    document.getElementById("darkToggle").onclick = () => {
      document.body.classList.toggle("dark-mode");
    };

    document.addEventListener("keydown", e => {
      if (e.key === 'n') nextQuestion();
      if (e.key === 'p') prevQuestion();
      if (e.key === 'r') markForReview();
      if (e.key === 's') confirmSubmit();
    });
  </script></body>
</html>
