<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Target Zone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen flex bg-gray-100">

  <!-- Sidebar -->
  <aside class="w-64 bg-gradient-to-b from-blue-800 to-indigo-900 text-white flex flex-col shadow-lg">
    <div class="p-6 text-center border-b border-blue-700">
      <h1 class="text-2xl font-bold">ğŸ¯ Target Zone</h1>
      <p class="text-sm text-gray-300">Admin Dashboard</p>
    </div>
    <nav class="flex-1 p-4">
      <ul class="space-y-3">
        <li><button onclick="showSection('add')" class="w-full text-left px-4 py-2 rounded hover:bg-blue-700">â• Add Question</button></li>
        <li><button onclick="showSection('manage')" class="w-full text-left px-4 py-2 rounded hover:bg-blue-700">ğŸ“‚ Manage Questions</button></li>
        <li><button onclick="showSection('results')" class="w-full text-left px-4 py-2 rounded hover:bg-blue-700">ğŸ“Š View Results</button></li>
        <li><button onclick="showSection('users')" class="w-full text-left px-4 py-2 rounded hover:bg-blue-700">ğŸ‘¥ Manage Users</button></li>
      </ul>
    </nav>
    <div class="p-4 border-t border-blue-700">
      <button onclick="logout()" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">ğŸšª Logout</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 overflow-y-auto">
    <h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ› ï¸ Admin Panel</h2>

    <!-- Add Question -->
    <div id="section-add" class="bg-white rounded-lg shadow-lg p-6 hidden">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">â• Add New Question</h3>
      <label class="block mb-2 font-semibold">Exam Category</label>
      <select id="exam-category" class="w-full border rounded-lg px-3 py-2 mb-3">
        <option value="ssc_gd">SSC GD</option>
        <option value="wbp_constable">WBP Constable</option>
        <option value="wbpsc_clerkship">WBPSC Clerkship</option>
        <option value="railway_ntpc">Railway NTPC</option>
        <option value="tet_primary">WB Primary TET</option>
      </select>
      <label class="block mb-2 font-semibold">Set Number</label>
      <input type="number" id="set-number" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="à¦¯à§‡à¦®à¦¨: 1">
      <textarea id="question" rows="3" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨..."></textarea>
      <div class="grid grid-cols-2 gap-3">
        <input type="text" id="option1" class="border rounded-lg px-3 py-2" placeholder="Option 1">
        <input type="text" id="option2" class="border rounded-lg px-3 py-2" placeholder="Option 2">
        <input type="text" id="option3" class="border rounded-lg px-3 py-2" placeholder="Option 3">
        <input type="text" id="option4" class="border rounded-lg px-3 py-2" placeholder="Option 4">
      </div>
      <input type="text" id="answer" class="w-full border rounded-lg px-3 py-2 mt-3" placeholder="à¦¸à¦ à¦¿à¦• à¦‰à¦¤à§à¦¤à¦°">
      <button onclick="addQuestion()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-lg font-semibold">ğŸ’¾ Save Question</button>
      <p id="status" class="text-green-600 font-semibold mt-4"></p>
    </div>

    <!-- Manage Questions -->
    <div id="section-manage" class="bg-white rounded-lg shadow-lg p-6 hidden">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ“‚ Manage Questions</h3>
      <input type="text" id="search-box" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="ğŸ” à¦¸à¦¾à¦°à§à¦š à¦•à¦°à§à¦¨...">
      <button onclick="viewQuestions()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg text-lg font-semibold mb-4">ğŸ“¥ Load Questions</button>
      <div id="questions-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
    </div>

    <!-- View Results -->
    <div id="section-results" class="bg-white rounded-lg shadow-lg p-6 hidden">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ“Š View Results</h3>
      <div id="results-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
    </div>

    <!-- Manage Users -->
    <div id="section-users" class="bg-white rounded-lg shadow-lg p-6 hidden">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ‘¥ Registered Users</h3>
      <div id="users-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Toggle Sections
    window.showSection = function(section){
      ["add","manage","results","users"].forEach(s=>{
        document.getElementById(`section-${s}`).classList.add("hidden");
      });
      document.getElementById(`section-${section}`).classList.remove("hidden");
      if(section==="results") loadResults();
      if(section==="users") loadUsers();
    }

    // Add Question
    window.addQuestion = async function() {
      const examCategory = document.getElementById("exam-category").value;
      const setNumber = document.getElementById("set-number").value.trim();
      const question = document.getElementById("question").value.trim();
      const options = [
        document.getElementById("option1").value.trim(),
        document.getElementById("option2").value.trim(),
        document.getElementById("option3").value.trim(),
        document.getElementById("option4").value.trim()
      ];
      const answer = document.getElementById("answer").value.trim();

      if (!examCategory || !setNumber || !question || options.some(opt => !opt) || !answer) {
        document.getElementById("status").textContent = "âš ï¸ à¦¸à¦¬ à¦˜à¦° à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨à¥¤";
        return;
      }

      const snapshot = await getDocs(collection(db, `${examCategory}_set${setNumber}`));
      const id = snapshot.size + 1;
      await addDoc(collection(db, `${examCategory}_set${setNumber}`), { id, question, options, answer });
      document.getElementById("status").textContent = "âœ… à¦ªà§à¦°à¦¶à§à¦¨ à¦¯à§‹à¦— à¦¹à¦¯à¦¼à§‡à¦›à§‡!";
    }

    // Manage Questions
    window.viewQuestions = async function() {
      const examCategory = document.getElementById("exam-category").value;
      const setNumber = document.getElementById("set-number").value.trim();
      const searchText = document.getElementById("search-box").value.trim().toLowerCase();
      const listDiv = document.getElementById("questions-list");
      listDiv.innerHTML = "â³ à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...";

      const q = query(collection(db, `${examCategory}_set${setNumber}`), orderBy("id"));
      const snapshot = await getDocs(q);
      let html = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (!searchText || data.question.toLowerCase().includes(searchText)) {
          html += `<div class="p-4 border rounded-lg bg-white shadow">
            <b>${data.id}. ${data.question}</b><br>
            ${data.options.map(o=>`<li>${o}</li>`).join("")}
            âœ… ${data.answer}
          </div>`;
        }
      });
      listDiv.innerHTML = html || "âŒ à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦¨à§‡à¦‡à¥¤";
    }

    // Results
    async function loadResults(){
      const listDiv=document.getElementById("results-list");
      listDiv.innerHTML="â³ à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...";
      const q=query(collection(db,"results"),orderBy("submittedAt","desc"));
      const snapshot=await getDocs(q);
      let html="";
      snapshot.forEach(docSnap=>{
        const r=docSnap.data();
        html+=`<div class="p-4 border rounded bg-gray-50 shadow">
          <b>${r.exam.toUpperCase()}</b> - ${r.email}<br>
          ğŸ† ${r.score}/${r.total} | âœ… ${r.correct}, âŒ ${r.wrong}, âšª ${r.unattempted}
        </div>`;
      });
      listDiv.innerHTML=html||"âŒ à¦•à§‹à¦¨à§‹ à¦°à§‡à¦œà¦¾à¦²à§à¦Ÿ à¦¨à§‡à¦‡à¥¤";
    }

    // Users
    async function loadUsers(){
      const listDiv=document.getElementById("users-list");
      listDiv.innerHTML="â³ à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...";
      const snapshot=await getDocs(collection(db,"users"));
      let html="";
      snapshot.forEach(docSnap=>{
        const u=docSnap.data();
        html+=`<div class="p-4 border rounded bg-gray-50 shadow">
          ğŸ‘¤ ${u.fullName || "No Name"}<br>
          ğŸ“§ ${u.email}<br>
          ğŸ“… Joined: ${u.joinedAt?.toDate().toLocaleDateString()}
        </div>`;
      });
      listDiv.innerHTML=html||"âŒ à¦•à§‹à¦¨à§‹ à¦‡à¦‰à¦œà¦¾à¦° à¦¨à§‡à¦‡à¥¤";
    }
  </script>
</body>
</html>
