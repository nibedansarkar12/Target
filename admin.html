<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Target Zone - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg,#0f2027,#203a43,#2c5364); color:white; font-family:'Segoe UI',sans-serif; overflow:hidden; }
    .sidebar { background: linear-gradient(180deg,#1e3c72,#2a5298); transition: transform 0.4s ease; }
    .sidebar.hidden { transform: translateX(-100%); }
    .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); color:black; }
    .rainbow { background: linear-gradient(90deg,#ff7e5f,#feb47b,#ff6a00,#ee0979,#6a11cb,#2575fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight:bold; }
    .nav-btn { display:flex; align-items:center; gap:10px; transition:all 0.3s; background:rgba(255,255,255,0.1); }
    .nav-btn:hover { background:linear-gradient(90deg,#ff7e5f,#feb47b,#6a11cb); color:white; transform:translateX(5px); }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser=null;
    onAuthStateChanged(auth, user=>{
      if(!user){ window.location.href="index.html"; }
      else{
        currentUser=user;
        document.getElementById("admin-email").textContent="üë§ "+user.email;
        loadQuestions(); loadResults(); loadUsers();
      }
    });

    window.logout=async()=>{ await signOut(auth); window.location.href="index.html"; };

    window.addQuestion=async()=>{
      const cat=document.getElementById("category").value;
      const ques=document.getElementById("question").value;
      const opts=[1,2,3,4].map(i=>document.getElementById("option"+i).value);
      const ans=document.getElementById("answer").value;
      if(!ques||!ans) return alert("‚ö†Ô∏è ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
      await addDoc(collection(db,cat),{question:ques,options:opts,answer:ans,createdAt:new Date()});
      alert("‚úÖ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      loadQuestions();
    };

    async function loadQuestions(){
      const table=document.getElementById("questions-list");
      table.innerHTML="<tr><td colspan='4'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";
      const cats=["ssc","railways","tet"];
      let rows="";
      for(const cat of cats){
        const snapshot=await getDocs(collection(db,cat));
        snapshot.forEach(docSnap=>{
          const q=docSnap.data();
          rows+=`
            <tr>
              <td>${cat.toUpperCase()}</td>
              <td>${q.question}</td>
              <td>${q.answer}</td>
              <td><button onclick="deleteQuestion('${cat}','${docSnap.id}')" class="bg-red-500 text-white px-2 py-1 rounded">üóë</button></td>
            </tr>
          `;
        });
      }
      table.innerHTML=rows||"<tr><td colspan='4'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á</td></tr>";
    }
    window.deleteQuestion=async(cat,id)=>{ await deleteDoc(doc(db,cat,id)); loadQuestions(); };

    async function loadResults(){
      const table=document.getElementById("results-list");
      table.innerHTML="<tr><td colspan='4'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";
      const snapshot=await getDocs(collection(db,"results"));
      let rows="";
      snapshot.forEach(docSnap=>{
        const r=docSnap.data();
        rows+=`
          <tr>
            <td>${r.email}</td>
            <td>${r.exam}</td>
            <td>${r.score}/${r.total}</td>
            <td>${new Date(r.submittedAt?.seconds*1000||Date.now()).toLocaleString()}</td>
          </tr>
        `;
      });
      table.innerHTML=rows||"<tr><td colspan='4'>‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶®‡ßá‡¶á</td></tr>";
    }

    async function loadUsers(){
      const table=document.getElementById("users-list");
      table.innerHTML="<tr><td colspan='2'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";
      const snapshot=await getDocs(collection(db,"users"));
      let rows="";
      snapshot.forEach(docSnap=>{
        const u=docSnap.data();
        rows+=`<tr><td>${u.email}</td><td>${u.name||"Unknown"}</td></tr>`;
      });
      table.innerHTML=rows||"<tr><td colspan='2'>‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</td></tr>";
    }
  </script>
</head>
<body class="h-screen flex overflow-hidden">
  <!-- Background Animation -->
  <canvas id="bg-canvas" class="fixed top-0 left-0 w-full h-full -z-10"></canvas>
  <button id="toggle-bg" class="fixed top-4 right-4 bg-red-500 text-white px-3 py-1 rounded shadow-lg z-50">‚úñÔ∏è Stop Animation</button>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed md:static w-64 h-full text-white z-50 hidden md:flex flex-col">
    <div class="p-5 flex justify-between items-center border-b border-white/20">
      <div>
        <h1 class="rainbow text-2xl">üåà Target Zone</h1>
        <p id="admin-email" class="text-sm"></p>
      </div>
      <button id="close-sidebar" class="md:hidden text-xl">‚ùå</button>
    </div>
    <nav class="p-4 space-y-3 flex-1">
      <button onclick="showSection('add')" class="nav-btn w-full py-2 px-3 rounded">‚ûï Add Question</button>
      <button onclick="showSection('manage')" class="nav-btn w-full py-2 px-3 rounded">üìÇ Manage Questions</button>
      <button onclick="showSection('results')" class="nav-btn w-full py-2 px-3 rounded">üìä View Results</button>
      <button onclick="showSection('users')" class="nav-btn w-full py-2 px-3 rounded">üë• Manage Users</button>
    </nav>
    <div class="p-4 border-t border-white/20">
      <button onclick="logout()" class="w-full bg-red-600 py-2 rounded">üö™ Logout</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
      <button id="menu-btn" class="md:hidden bg-yellow-400 px-3 py-2 rounded">‚ò∞</button>
      <h2 class="rainbow text-3xl">üõ†Ô∏è Admin Panel</h2>
      <audio id="bg-music" controls autoplay loop class="w-40">
        <source src="YOUR_SONG_LINK_HERE.mp3" type="audio/mp3">
      </audio>
    </div>

    <!-- Sections -->
    <section id="section-add" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">‚ûï Add New Question</h3>
      <select id="category" class="w-full border rounded px-3 py-2 mb-3">
        <option value="ssc">SSC</option>
        <option value="railways">Railways</option>
        <option value="tet">TET</option>
      </select>
      <textarea id="question" rows="3" class="w-full border rounded px-3 py-2 mb-3" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      <input id="option1" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 1">
      <input id="option2" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 2">
      <input id="option3" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 3">
      <input id="option4" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 4">
      <input id="answer" class="w-full border rounded px-3 py-2 mb-3" placeholder="‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞">
      <button onclick="addQuestion()" class="w-full bg-blue-600 text-white py-2 rounded">üíæ Save Question</button>
    </section>

    <section id="section-manage" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üìÇ Manage Questions</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Category</th><th>Question</th><th>Answer</th><th>Delete</th></tr></thead>
        <tbody id="questions-list"></tbody>
      </table>
    </section>

    <section id="section-results" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üìä View Results</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Exam</th><th>Score</th><th>Submitted</th></tr></thead>
        <tbody id="results-list"></tbody>
      </table>
    </section>

    <section id="section-users" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üë• Manage Users</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Name</th></tr></thead>
        <tbody id="users-list"></tbody>
      </table>
    </section>
  </main>

  <script>
    const sections=["add","manage","results","users"];
    window.showSection=function(id){
      sections.forEach(sec=>document.getElementById("section-"+sec).classList.add("hidden"));
      document.getElementById("section-"+id).classList.remove("hidden");
    };
    document.getElementById("menu-btn").addEventListener("click",()=>{document.getElementById("sidebar").classList.remove("hidden");});
    document.getElementById("close-sidebar").addEventListener("click",()=>{document.getElementById("sidebar").classList.add("hidden");});
  </script>

  <!-- Background Animation -->
  <script>
    const canvas=document.getElementById("bg-canvas");
    const ctx=canvas.getContext("2d");
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;

    let stars=[], planes=[];
    for(let i=0;i<150;i++){
      stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5});
    }
    for(let i=0;i<2;i++){
      planes.push({x:-50,y:Math.random()*canvas.height/2,dx:2+Math.random()*2,size:20});
    }

    function draw(){
      ctx.fillStyle="rgba(0,0,30,0.4)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="white";
      stars.forEach(s=>{
        ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
        s.x+=s.dx;s.y+=s.dy;
        if(s.x<0||s.x>canvas.width) s.dx*=-1;
        if(s.y<0||s.y>canvas.height) s.dy*=-1;
      });
      planes.forEach(p=>{
        ctx.fillStyle="lightblue";ctx.fillRect(p.x,p.y,p.size,3);
        ctx.fillStyle="white";ctx.fillRect(p.x-5,p.y+1,10,1);
        p.x+=p.dx;if(p.x>canvas.width+50){p.x=-50;p.y=Math.random()*canvas.height/2;}
      });
    }
    let animation=setInterval(draw,30);
    document.getElementById("toggle-bg").addEventListener("click",()=>{
      if(animation){clearInterval(animation);animation=null;document.getElementById("toggle-bg").textContent="‚ñ∂Ô∏è Start Animation";}
      else{animation=setInterval(draw,30);document.getElementById("toggle-bg").textContent="‚úñÔ∏è Stop Animation";}
    });
  </script>
</body>
</html>
