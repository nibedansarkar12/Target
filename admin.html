<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Target Zone</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-8 px-4">

  <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>

    <!-- ‚úÖ Exam ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Exam</label>
      <select id="category" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 sm:text-sm">
        <option value="">--Select--</option>
        <option value="ssc">SSC</option>
        <option value="railways">Railways</option>
        <option value="tet">TET</option>
        <option value="wbset">WB SET</option>
        <option value="wbjee">WBJEE</option>
        <option value="madhyamik">Madhyamik</option>
      </select>
    </div>

    <!-- ‚úÖ Set ‡¶á‡¶®‡¶™‡ßÅ‡¶ü (‡¶®‡¶§‡ßÅ‡¶®) -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Set (‡¶Ø‡ßá‡¶Æ‡¶®‡¶É Set A)</label>
      <input type="text" id="set" placeholder="Set A" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 sm:text-sm" required>
    </div>

    <!-- ‚úÖ Question -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Question</label>
      <input type="text" id="question" class="w-full border p-2 rounded">
    </div>

    <!-- ‚úÖ Options -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <input type="text" id="option1" placeholder="Option 1" class="border p-2 rounded">
      <input type="text" id="option2" placeholder="Option 2" class="border p-2 rounded">
      <input type="text" id="option3" placeholder="Option 3" class="border p-2 rounded">
      <input type="text" id="option4" placeholder="Option 4" class="border p-2 rounded">
    </div>

    <!-- ‚úÖ Answer -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Correct Option Number (1-4)</label>
      <input type="number" id="answer" class="w-full border p-2 rounded" min="1" max="4">
    </div>

    <!-- ‚úÖ Optional Image -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700">Image (optional)</label>
      <input type="file" id="photo" class="w-full">
    </div><!-- ‚úÖ Submit Button -->
    <div class="mt-6">
      <button onclick="addQuestion()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">‚ûï ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  </div>

  <!-- ‚úÖ Firebase Config + addQuestion() Function -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import {
      getStorage, ref, uploadBytes, getDownloadURL
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    window.addQuestion = async () => {
      const cat = document.getElementById("category").value;
      const set = document.getElementById("set").value.trim();
      const ques = document.getElementById("question").value;
      const opt1 = document.getElementById("option1").value;
      const opt2 = document.getElementById("option2").value;
      const opt3 = document.getElementById("option3").value;
      const opt4 = document.getElementById("option4").value;
      const answerIndex = parseInt(document.getElementById("answer").value) - 1;
      const photoFile = document.getElementById("photo").files[0];

      if (!cat || !set || !ques || !opt1 || !opt2 || !opt3 || !opt4 || isNaN(answerIndex)) {
        alert(\"‚ö†Ô∏è ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§\");
        return;
      }

      let photoURL = \"\";
      if (photoFile) {
        const storageRef = ref(storage, `questions/${Date.now()}_${photoFile.name}`);
        await uploadBytes(storageRef, photoFile);
        photoURL = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, `${cat}_sets/${set}/questions`), {
        id: Date.now(),
        question: ques,
        options: [opt1, opt2, opt3, opt4],
        answer: [opt1, opt2, opt3, opt4][answerIndex],
        image: photoURL
      });

      alert(\"‚úÖ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\");
      document.getElementById(\"question\").value = \"\";
      document.getElementById(\"option1\").value = \"\";
      document.getElementById(\"option2\").value = \"\";
      document.getElementById(\"option3\").value = \"\";
      document.getElementById(\"option4\").value = \"\";
      document.getElementById(\"answer\").value = \"\";
      document.getElementById(\"photo\").value = \"\";
    };
  </script><!-- ‚úÖ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
    <div class="mt-6">
      <button onclick="loadQuestions()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">üìÑ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
      <ul id="question-list" class="mt-4 space-y-2 text-sm text-gray-800 bg-white p-4 rounded"></ul>
    </div>

  </div> <!-- form container end -->

  <script type="module">
    import { getDocs, collection } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    window.loadQuestions = async () => {
      const exam = document.getElementById("category").value;
      const set = document.getElementById("set").value.trim();
      const list = document.getElementById("question-list");
      list.innerHTML = "‚è≥ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

      if (!exam || !set) {
        list.innerHTML = "‚ö†Ô∏è ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá Exam ‡¶è‡¶¨‡¶Ç Set ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        return;
      }

      const snap = await getDocs(collection(db, `${exam}_sets/${set}/questions`));
      if (snap.empty) {
        list.innerHTML = "‚ùå ‡¶è‡¶á ‡¶∏‡ßá‡¶ü‡ßá ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";
        return;
      }

      list.innerHTML = "";
      snap.forEach(doc => {
        const q = doc.data();
        list.innerHTML += `<li><strong>Q${q.id}:</strong> ${q.question}</li>`;
      });
    };
  </script>

</body>
</html>
