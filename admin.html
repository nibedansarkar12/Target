<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Target Zone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
    <h1 class="text-2xl font-bold mb-6 text-center">ЁЯЫая╕П Admin Panel</h1>

    <!-- Exam Category -->
    <label class="block mb-2 font-semibold">Exam Category:</label>
    <select id="exam-category" class="w-full border rounded px-3 py-2 mb-4">
      <option value="ssc">SSC GD</option>
      <option value="railways">Railways</option>
      <option value="tet">TET</option>
      <option value="wbset">WB SET</option>
      <option value="wbjee">WBJEE</option>
      <option value="madhyamik">Madhyamik / HS</option>
    </select>

    <!-- Set Selection -->
    <label class="block mb-2 font-semibold">Set Number:</label>
    <input type="number" id="set-number" class="w-full border rounded px-3 py-2 mb-4" placeholder="ржпрзЗржоржи: 1">

    <!-- Add Question -->
    <h2 class="text-xl font-semibold mb-3">тЮХ Add Question</h2>
    <textarea id="question" rows="3" class="w-full border rounded px-3 py-2 mb-3" placeholder="ржПржЦрж╛ржирзЗ ржкрзНрж░рж╢рзНржи рж▓рж┐ржЦрзБржи"></textarea>
    <input type="text" id="option1" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 1">
    <input type="text" id="option2" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 2">
    <input type="text" id="option3" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 3">
    <input type="text" id="option4" class="w-full border rounded px-3 py-2 mb-4" placeholder="Option 4">
    <input type="text" id="answer" class="w-full border rounded px-3 py-2 mb-4" placeholder="рж╕ржарж┐ржХ ржЙрждрзНрждрж░">
    <input type="text" id="section" class="w-full border rounded px-3 py-2 mb-4" placeholder="Section (ржпрзЗржоржи GK)">
    <button onclick="addQuestion()" class="w-full bg-blue-600 text-white py-2 rounded text-lg font-semibold">ЁЯТ╛ Add Question</button>
    <p id="status" class="text-green-600 font-semibold mt-4 text-center"></p>

    <!-- Search Box -->
    <h2 class="text-xl font-semibold mt-8 mb-3">ЁЯФН Search Questions</h2>
    <input type="text" id="search-box" class="w-full border rounded px-3 py-2 mb-4" placeholder="ржХрзЛржирзЛ рж╢ржмрзНржж рж▓рж┐ржЦрзБржи...">
    <button onclick="viewQuestions()" class="w-full bg-yellow-500 text-white py-2 rounded text-lg font-semibold mb-4">ЁЯУВ Load Questions</button>
    
    <!-- Question List -->
    <div id="questions-list" class="space-y-3 max-h-96 overflow-y-auto border p-3 rounded bg-gray-50"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ЁЯФе Firebase Config (рждрзЛржорж╛рж░ ржЖржЧрзЗрж░ ржжрзЗржУрзЯрж╛)
    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // тЮХ Add Question
    window.addQuestion = async function() {
      const examCategory = document.getElementById("exam-category").value;
      const setNumber = document.getElementById("set-number").value.trim();
      const question = document.getElementById("question").value.trim();
      const options = [
        document.getElementById("option1").value.trim(),
        document.getElementById("option2").value.trim(),
        document.getElementById("option3").value.trim(),
        document.getElementById("option4").value.trim()
      ];
      const answer = document.getElementById("answer").value.trim();
      const section = document.getElementById("section").value.trim() || "General";

      if (!examCategory || !setNumber || !question || options.some(opt => !opt) || !answer) {
        document.getElementById("status").textContent = "тЪая╕П рж╕ржм ржШрж░ ржкрзВрж░ржг ржХрж░рзБржиред";
        return;
      }

      const snapshot = await getDocs(collection(db, `${examCategory}_set${setNumber}`));
      const id = snapshot.size + 1;

      await addDoc(collection(db, `${examCategory}_set${setNumber}`), { id, question, options, answer, section });

      document.getElementById("status").textContent = "тЬЕ ржкрзНрж░рж╢рзНржи рж╕ржлрж▓ржнрж╛ржмрзЗ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ!";
      
      ["question","option1","option2","option3","option4","answer","section"].forEach(id => document.getElementById(id).value="");
    }

    // ЁЯСБ View & Search Questions
    window.viewQuestions = async function() {
      const examCategory = document.getElementById("exam-category").value;
      const setNumber = document.getElementById("set-number").value.trim();
      const searchText = document.getElementById("search-box").value.trim().toLowerCase();
      const listDiv = document.getElementById("questions-list");
      listDiv.innerHTML = "<p class='text-blue-600'>тП│ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>";

      const q = query(collection(db, `${examCategory}_set${setNumber}`), orderBy("id"));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        listDiv.innerHTML = "<p class='text-red-600'>тЭМ ржХрзЛржирзЛ ржкрзНрж░рж╢рзНржи ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</p>";
        return;
      }

      let html = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (!searchText || data.question.toLowerCase().includes(searchText) || data.options.some(opt => opt.toLowerCase().includes(searchText))) {
          html += `
            <div class="p-3 border rounded bg-white">
              <b>${data.id}. ${data.question}</b><br>
              <ul class="ml-4 list-disc">
                ${data.options.map(opt => `<li>${opt}</li>`).join("")}
              </ul>
              тЬЕ <span class="text-green-600">${data.answer}</span>
              <br><small class="text-gray-500">Section: ${data.section}</small>
              <div class="mt-2 flex gap-2">
                <button onclick="deleteQuestion('${examCategory}_set${setNumber}','${docSnap.id}')" class="bg-red-500 text-white px-2 py-1 rounded">ЁЯЧС Delete</button>
                <button onclick="editQuestion('${examCategory}_set${setNumber}','${docSnap.id}','${data.question}','${data.answer}','${data.section}','${data.options.join("|||")}')" class="bg-green-600 text-white px-2 py-1 rounded">тЬП Edit</button>
              </div>
            </div>
          `;
        }
      });

      listDiv.innerHTML = html || "<p class='text-red-600'>тЭМ ржХрзЛржирзЛ ржорж┐рж▓рзЗ ржпрж╛ржУржпрж╝рж╛ ржкрзНрж░рж╢рзНржи ржирзЗржЗред</p>";
    }

    // ЁЯЧС Delete Question
    window.deleteQuestion = async function(collectionName, docId) {
      if(confirm("ржЖржкржирж┐ ржХрж┐ ржкрзНрж░рж╢рзНржиржЯрж┐ ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ ржЪрж╛ржи?")) {
        await deleteDoc(doc(db, collectionName, docId));
        alert("тЬЕ ржкрзНрж░рж╢рзНржи ржорзБржЫрзЗ ржлрзЗрж▓рж╛ рж╣ржпрж╝рзЗржЫрзЗ");
        viewQuestions();
      }
    }

    // тЬП Edit Question
    window.editQuestion = async function(collectionName, docId, question, answer, section, options) {
      const newQ = prompt("Edit Question:", question);
      if(!newQ) return;
      const newA = prompt("Edit Answer:", answer);
      const newS = prompt("Edit Section:", section);
      const newOptions = prompt("Edit Options (||| ржжрж┐ржпрж╝рзЗ ржЖрж▓рж╛ржжрж╛ ржХрж░рзБржи):", options);

      await updateDoc(doc(db, collectionName, docId), {
        question: newQ,
        answer: newA,
        section: newS,
        options: newOptions.split("|||").map(o => o.trim())
      });

      alert("тЬЕ ржкрзНрж░рж╢рзНржи ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ");
      viewQuestions();
    }
  </script>
</body>
</html>
