<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Target Zone - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .slide-in { transform: translateX(0); transition: transform 0.3s ease-in-out; }
    .slide-out { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
    .dark-mode { background: #1e293b; color: white; }
  </style>
</head>
<body class="bg-gray-100 flex h-screen">

  <!-- Sidebar -->
  <aside id="sidebar" class="slide-out fixed top-0 left-0 h-full w-64 bg-gradient-to-b from-blue-700 via-indigo-800 to-purple-900 text-white shadow-xl z-50">
    <div class="flex items-center justify-between p-4 border-b border-indigo-600">
      <h1 class="text-xl font-bold">ğŸ¯ Target Zone</h1>
      <button onclick="toggleSidebar()" class="text-white text-2xl">âœ–</button>
    </div>
    <nav class="p-4 space-y-3">
      <button onclick="showSection('add')" class="w-full flex items-center gap-2 px-4 py-2 rounded hover:bg-indigo-600 transition">â• Add Question</button>
      <button onclick="showSection('manage')" class="w-full flex items-center gap-2 px-4 py-2 rounded hover:bg-indigo-600 transition">ğŸ“‚ Manage Questions</button>
      <button onclick="showSection('results')" class="w-full flex items-center gap-2 px-4 py-2 rounded hover:bg-indigo-600 transition">ğŸ“Š View Results</button>
      <button onclick="showSection('users')" class="w-full flex items-center gap-2 px-4 py-2 rounded hover:bg-indigo-600 transition">ğŸ‘¥ Manage Users</button>
    </nav>
    <div class="p-4 border-t border-indigo-600">
      <button onclick="toggleDarkMode()" class="w-full bg-yellow-500 hover:bg-yellow-600 px-4 py-2 rounded mb-2">ğŸŒ™ Dark Mode</button>
      <button onclick="logout()" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">ğŸšª Logout</button>
    </div>
  </aside>

  <!-- Content Area -->
  <div class="flex-1 flex flex-col">
    <!-- Top Navbar -->
    <header class="bg-white shadow flex items-center justify-between p-4">
      <button onclick="toggleSidebar()" class="text-3xl text-indigo-800">â˜°</button>
      <h2 class="text-xl font-bold text-gray-700">ğŸ› ï¸ Admin Panel</h2>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto space-y-6">

      <!-- Add Question -->
      <section id="section-add" class="hidden bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">â• Add New Question</h3>
        <select id="exam-category" class="w-full border rounded-lg px-3 py-2 mb-3">
          <option value="ssc_gd">SSC GD</option>
          <option value="wbp_constable">WBP Constable</option>
          <option value="wbpsc_clerkship">WBPSC Clerkship</option>
          <option value="railway_ntpc">Railway NTPC</option>
          <option value="tet_primary">WB Primary TET</option>
        </select>
        <input type="number" id="set-number" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Set Number">
        <textarea id="question" rows="3" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨..."></textarea>
        <div class="grid grid-cols-2 gap-3">
          <input type="text" id="option1" class="border rounded-lg px-3 py-2" placeholder="Option 1">
          <input type="text" id="option2" class="border rounded-lg px-3 py-2" placeholder="Option 2">
          <input type="text" id="option3" class="border rounded-lg px-3 py-2" placeholder="Option 3">
          <input type="text" id="option4" class="border rounded-lg px-3 py-2" placeholder="Option 4">
        </div>
        <input type="text" id="answer" class="w-full border rounded-lg px-3 py-2 mt-3" placeholder="à¦¸à¦ à¦¿à¦• à¦‰à¦¤à§à¦¤à¦°">
        <button onclick="addQuestion()" class="w-full mt-4 bg-indigo-700 hover:bg-indigo-800 text-white py-2 rounded-lg text-lg font-semibold">ğŸ’¾ Save Question</button>
        <p id="status" class="text-green-600 font-semibold mt-4"></p>
      </section>

      <!-- Manage Questions -->
      <section id="section-manage" class="hidden bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ“‚ Manage Questions</h3>
        <input type="text" id="search-box" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="ğŸ” à¦¸à¦¾à¦°à§à¦š à¦•à¦°à§à¦¨...">
        <button onclick="viewQuestions()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg text-lg font-semibold mb-4">ğŸ“¥ Load Questions</button>
        <div id="questions-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
      </section>

      <!-- View Results -->
      <section id="section-results" class="hidden bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ“Š View Results</h3>
        <canvas id="resultChart" width="400" height="200" class="mb-6"></canvas>
        <button onclick="downloadPDF()" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">â¬‡ï¸ Download PDF</button>
        <div id="results-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
      </section>

      <!-- Manage Users -->
      <section id="section-users" class="hidden bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-semibold mb-4 border-b pb-2">ğŸ‘¥ Registered Users</h3>
        <div id="users-list" class="space-y-3 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
      </section>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const sidebar=document.getElementById("sidebar");
    window.toggleSidebar=function(){
      sidebar.classList.toggle("slide-in");
      sidebar.classList.toggle("slide-out");
    }
    window.toggleDarkMode=function(){
      document.body.classList.toggle("dark-mode");
    }
    window.showSection=function(section){
      ["add","manage","results","users"].forEach(s=>{
        document.getElementById(`section-${s}`).classList.add("hidden");
      });
      document.getElementById(`section-${section}`).classList.remove("hidden");
      if(section==="results") loadResults();
      if(section==="users") loadUsers();
    }

    // Add Question
    window.addQuestion=async function(){
      const category=document.getElementById("exam-category").value;
      const setNumber=document.getElementById("set-number").value.trim();
      const question=document.getElementById("question").value.trim();
      const options=[
        document.getElementById("option1").value.trim(),
        document.getElementById("option2").value.trim(),
        document.getElementById("option3").value.trim(),
        document.getElementById("option4").value.trim()
      ];
      const answer=document.getElementById("answer").value.trim();
      if(!category||!setNumber||!question||options.some(o=>!o)||!answer){
        document.getElementById("status").textContent="âš ï¸ à¦¸à¦¬ à¦˜à¦° à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨!";
        return;
      }
      await addDoc(collection(db,`${category}_set${setNumber}`),{question,options,answer});
      document.getElementById("status").textContent="âœ… à¦ªà§à¦°à¦¶à§à¦¨ à¦¯à§‹à¦— à¦¹à¦¯à¦¼à§‡à¦›à§‡!";
    }

    // View + Edit + Delete Questions
    window.viewQuestions=async function(){
      const category=document.getElementById("exam-category").value;
      const setNumber=document.getElementById("set-number").value.trim();
      const q=query(collection(db,`${category}_set${setNumber}`),orderBy("question"));
      const snapshot=await getDocs(q);
      const list=document.getElementById("questions-list");
      let html="";
      snapshot.forEach(docSnap=>{
        const data=docSnap.data();
        html+=`<div class="p-3 border rounded bg-white shadow">
          <b>${data.question}</b><br>
          ${data.options.map(o=>`<li>${o}</li>`).join("")}
          âœ… ${data.answer}<br>
          <button onclick="editQuestion('${docSnap.id}','${category}_set${setNumber}')" class="bg-green-600 text-white px-2 py-1 rounded mr-2">âœ Edit</button>
          <button onclick="deleteQuestion('${docSnap.id}','${category}_set${setNumber}')" class="bg-red-600 text-white px-2 py-1 rounded">ğŸ—‘ Delete</button>
        </div>`;
      });
      list.innerHTML=html||"âŒ à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦¨à§‡à¦‡à¥¤";
    }

    // Delete Question
    window.deleteQuestion=async function(id,collectionName){
      if(confirm("à¦†à¦ªà¦¨à¦¿ à¦•à¦¿ à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¤à§‡ à¦šà¦¾à¦¨?")){
        await deleteDoc(doc(db,collectionName,id));
        alert("âŒ à¦ªà§à¦°à¦¶à§à¦¨ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡!");
        viewQuestions();
      }
    }

    // Edit Question
    window.editQuestion=async function(id,collectionName){
      const newQuestion=prompt("à¦¨à¦¤à§à¦¨ à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨:");
      if(!newQuestion) return;
      await updateDoc(doc(db,collectionName,id),{question:newQuestion});
      alert("âœ à¦ªà§à¦°à¦¶à§à¦¨ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦¹à¦¯à¦¼à§‡à¦›à§‡!");
      viewQuestions();
    }

    // Results
    async function loadResults(){
      const q=query(collection(db,"results"),orderBy("submittedAt","desc"));
      const snapshot=await getDocs(q);
      const list=document.getElementById("results-list");
      let html="",correct=0,wrong=0,unattempted=0;
      snapshot.forEach(docSnap=>{
        const r=docSnap.data();
        correct+=r.correct; wrong+=r.wrong; unattempted+=r.unattempted;
        html+=`<div class="p-3 border rounded bg-gray-50 shadow">
          <b>${r.exam.toUpperCase()}</b> - ${r.email}<br>
          ğŸ† ${r.score}/${r.total} | âœ… ${r.correct}, âŒ ${r.wrong}, âšª ${r.unattempted}
        </div>`;
      });
      list.innerHTML=html||"âŒ à¦•à§‹à¦¨à§‹ à¦°à§‡à¦œà¦¾à¦²à§à¦Ÿ à¦¨à§‡à¦‡à¥¤";
      new Chart(document.getElementById("resultChart"),{
        type:"pie",
        data:{labels:["Correct","Wrong","Unattempted"],
          datasets:[{data:[correct,wrong,unattempted],backgroundColor:["#4caf50","#f44336","#9e9e9e"]}]}
      });
    }

    // Users
    async function loadUsers(){
      const snapshot=await getDocs(collection(db,"users"));
      const list=document.getElementById("users-list");
      let html="";
      snapshot.forEach(docSnap=>{
        const u=docSnap.data();
        html+=`<div class="p-3 border rounded bg-gray-50 shadow">
          ğŸ‘¤ ${u.fullName||"No Name"}<br>
          ğŸ“§ ${u.email}<br>
          ğŸ“… Joined: ${u.joinedAt?.toDate().toLocaleDateString()}
        </div>`;
      });
      list.innerHTML=html||"âŒ à¦•à§‹à¦¨à§‹ à¦‡à¦‰à¦œà¦¾à¦° à¦¨à§‡à¦‡à¥¤";
    }

    // PDF Download
    window.downloadPDF=function(){
      const { jsPDF }=window.jspdf;
      const doc=new jsPDF();
      doc.text("Target Zone Results",20,20);
      doc.text(document.getElementById("results-list").innerText,20,40);
      doc.save("results.pdf");
    }
  </script>
</body>
</html>
