<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Target Zone - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: linear-gradient(135deg,#0f2027,#203a43,#2c5364); color:white; font-family:'Segoe UI',sans-serif; overflow:hidden; }
    .sidebar { background: linear-gradient(180deg,#1e3c72,#2a5298); transition: transform 0.4s ease; }
    .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); color:black; }
    .rainbow { background: linear-gradient(90deg,#ff7e5f,#feb47b,#6a11cb,#2575fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight:bold; }
    .nav-btn { display:flex; align-items:center; gap:10px; transition:all 0.3s; background:rgba(255,255,255,0.1); }
    .nav-btn:hover { background:linear-gradient(90deg,#ff7e5f,#feb47b,#6a11cb); color:white; transform:translateX(5px); }
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:999; }
    .modal img { max-width:90%; max-height:90%; border:5px solid white; border-radius:10px; }
  </style>
</head>
<body class="h-screen flex overflow-hidden">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed md:static w-64 h-full text-white z-50 hidden md:flex flex-col">
    <div class="p-5 flex justify-between items-center border-b border-white/20">
      <h1 class="rainbow text-2xl">ğŸŒˆ Target Zone</h1>
      <button id="close-sidebar" class="md:hidden text-xl">âŒ</button>
    </div>
    <nav class="p-4 space-y-3 flex-1">
      <button onclick="showSection('add')" class="nav-btn w-full py-2 px-3 rounded">â• Add Question</button>
      <button onclick="showSection('results')" class="nav-btn w-full py-2 px-3 rounded">ğŸ“Š View Results</button>
      <button onclick="showSection('users')" class="nav-btn w-full py-2 px-3 rounded">ğŸ‘¥ Manage Users</button>
    </nav>
    <div class="p-4 border-t border-white/20">
      <button onclick="logout()" class="w-full bg-red-600 py-2 rounded">ğŸšª Logout</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
      <button id="menu-btn" class="md:hidden bg-yellow-400 px-3 py-2 rounded">â˜°</button>
      <h2 class="rainbow text-3xl">ğŸ› ï¸ Admin Panel</h2>
    </div>

    <!-- Add Question -->
    <section id="section-add" class="glass p-6 rounded-lg shadow-lg hidden">
      <form id="question-form" class="space-y-3">
        <h3 class="text-xl font-bold mb-4">â• Add New Question</h3>
        <select id="category" class="w-full border rounded px-3 py-2 mb-3">
          <option value="">--Select Category--</option>
          <option value="ssc">SSC</option>
          <option value="railways">Railways</option>
          <option value="tet">TET</option>
        </select>
        <textarea id="question" rows="3" class="w-full border rounded px-3 py-2" placeholder="à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨..."></textarea>
        <input type="file" id="photo" accept="image/*" class="w-full mb-3">
        <div class="grid grid-cols-2 gap-3">
          <label><input type="radio" name="correct" value="0"> <input id="option1" class="w-full border rounded px-3 py-2" placeholder="Option A"></label>
          <label><input type="radio" name="correct" value="1"> <input id="option2" class="w-full border rounded px-3 py-2" placeholder="Option B"></label>
          <label><input type="radio" name="correct" value="2"> <input id="option3" class="w-full border rounded px-3 py-2" placeholder="Option C"></label>
          <label><input type="radio" name="correct" value="3"> <input id="option4" class="w-full border rounded px-3 py-2" placeholder="Option D"></label>
        </div>
        <button type="button" onclick="addQuestion()" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
      </form>

      <!-- Preview -->
      <div class="mt-4 p-3 border rounded bg-gray-100 text-black">
        <h4 class="font-bold">ğŸ“‹ Live Preview:</h4>
        <p id="preview"></p>
      </div>

      <!-- Search -->
      <div class="mt-6">
        <input type="text" id="search" placeholder="ğŸ” à¦ªà§à¦°à¦¶à§à¦¨ à¦–à§à¦à¦œà§à¦¨..." class="w-full border rounded px-3 py-2 mb-3">
      </div>

      <h3 class="text-lg font-semibold mt-6">ğŸ“‹ Added Questions</h3>
      <div class="max-h-64 overflow-y-auto border rounded mt-3"> 
        <table class="w-full text-left border">
          <thead><tr><th>Question</th><th>Answer</th><th>Delete</th></tr></thead>
          <tbody id="questions-list"></tbody>
        </table>
      </div>
    </section>

    <!-- Results -->
    <section id="section-results" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">ğŸ“Š View Results</h3>
      <canvas id="resultsChart" class="mb-6"></canvas>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Exam</th><th>Score</th></tr></thead>
        <tbody id="results-list"></tbody>
      </table>
    </section>

    <!-- Users -->
    <section id="section-users" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">ğŸ‘¥ Manage Users</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Name</th></tr></thead>
        <tbody id="users-list"></tbody>
      </table>
    </section>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const storage = getStorage(app);

    let currentCategory="";

    onAuthStateChanged(auth,user=>{
      if(!user){ window.location.href="index.html"; }
    });

    window.logout=async()=>{ await signOut(auth); window.location.href="index.html"; };

    // Show section
    window.showSection=(id)=>{
      document.querySelectorAll("section").forEach(sec=>sec.classList.add("hidden"));
      document.getElementById("section-"+id).classList.remove("hidden");
    }

    // Load Questions
    window.loadQuestions=async(category)=>{
      currentCategory=category;
      const table=document.getElementById("questions-list");
      table.innerHTML="<tr><td colspan='3'>à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...</td></tr>";
      const snapshot=await getDocs(collection(db,category));
      let rows="";
      snapshot.forEach(docSnap=>{
        const q=docSnap.data();
        rows+=`
          <tr>
            <td>${q.question}</td>
            <td>${q.answer}</td>
            <td><button onclick="deleteQuestion('${category}','${docSnap.id}')" class="bg-red-500 px-2 py-1 rounded">ğŸ—‘</button></td>
          </tr>
        `;
      });
      table.innerHTML=rows||"<tr><td colspan='3'>à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦¨à§‡à¦‡</td></tr>";
    }

    // Add Question
    window.addQuestion=async()=>{
      const cat=document.getElementById("category").value;
      const q=document.getElementById("question").value.trim();
      const opt1=document.getElementById("option1").value.trim();
      const opt2=document.getElementById("option2").value.trim();
      const opt3=document.getElementById("option3").value.trim();
      const opt4=document.getElementById("option4").value.trim();
      const correct=document.querySelector("input[name='correct']:checked");
      if(!cat||!q||!opt1||!opt2||!opt3||!opt4||!correct) return alert("âš ï¸ à¦¸à¦¬ à¦«à¦¿à¦²à§à¦¡ à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨!");

      let photoUrl="";
      const file=document.getElementById("photo").files[0];
      if(file){
        const storageRef=ref(storage,`questions/${Date.now()}_${file.name}`);
        await uploadBytes(storageRef,file);
        photoUrl=await getDownloadURL(storageRef);
      }

      await addDoc(collection(db,cat),{
        question:q,
        options:[opt1,opt2,opt3,opt4],
        answer:[opt1,opt2,opt3,opt4][correct.value],
        photo:photoUrl
      });
      alert("âœ… à¦ªà§à¦°à¦¶à§à¦¨ à¦¯à§‹à¦— à¦¹à¦¯à¦¼à§‡à¦›à§‡!");
      document.getElementById("question-form").reset();
      loadQuestions(cat);
    }

    // Delete Question
    window.deleteQuestion=async(cat,id)=>{
      if(!confirm("à¦†à¦ªà¦¨à¦¿ à¦•à¦¿ à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦à¦‡ à¦ªà§à¦°à¦¶à§à¦¨à¦Ÿà¦¿ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¤à§‡ à¦šà¦¾à¦¨?")) return;
      await deleteDoc(doc(db,cat,id));
      loadQuestions(cat);
    }

    // Live Preview
    document.getElementById("question").addEventListener("input",()=>{
      document.getElementById("preview").innerText=document.getElementById("question").value;
    });

    // Search
    document.getElementById("search").addEventListener("input",(e)=>{
      const text=e.target.value.toLowerCase();
      document.querySelectorAll("#questions-list tr").forEach(row=>{
        row.style.display=row.innerText.toLowerCase().includes(text)?"":"none";
      });
    });
  </script>
</body>
</html>
