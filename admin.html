<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Target Zone - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    // Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    // Firebase Config (‡¶§‡ßã‡¶Æ‡¶æ‡¶∞‡¶ü‡¶æ)
    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;

    // Auth check
    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = "index.html"; // üîÑ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶≤‡ßá index.html ‡¶è ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü
      } else {
        currentUser = user;
        document.getElementById("admin-email").textContent = "üë§ " + user.email;
        loadQuestions();
        loadResults();
        loadUsers();
      }
    });

    // Logout
    window.logout = async function() {
      await signOut(auth);
      window.location.href = "index.html";
    };

    // Add Question
    window.addQuestion = async function() {
      const cat = document.getElementById("category").value;
      const ques = document.getElementById("question").value;
      const opt1 = document.getElementById("option1").value;
      const opt2 = document.getElementById("option2").value;
      const opt3 = document.getElementById("option3").value;
      const opt4 = document.getElementById("option4").value;
      const ans = document.getElementById("answer").value;

      if (!ques || !ans) return alert("‚ö†Ô∏è ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");

      await addDoc(collection(db, cat), {
        question: ques,
        options: [opt1, opt2, opt3, opt4],
        answer: ans,
        createdAt: new Date()
      });
      alert("‚úÖ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      loadQuestions();
    };

    // Load Questions
    async function loadQuestions() {
      const table = document.getElementById("questions-list");
      table.innerHTML = "<tr><td colspan='5'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";

      const cats = ["ssc", "railways", "tet"]; // ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶∞‡ßã category ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã
      let rows = "";

      for (const cat of cats) {
        const snapshot = await getDocs(collection(db, cat));
        snapshot.forEach(docSnap => {
          const q = docSnap.data();
          rows += `
            <tr>
              <td>${cat.toUpperCase()}</td>
              <td>${q.question}</td>
              <td>${q.answer}</td>
              <td><button onclick="editQuestion('${cat}','${docSnap.id}')">‚úèÔ∏è Edit</button></td>
              <td><button onclick="deleteQuestion('${cat}','${docSnap.id}')">üóë Delete</button></td>
            </tr>
          `;
        });
      }
      table.innerHTML = rows || "<tr><td colspan='5'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á</td></tr>";
    }

    // Delete Question
    window.deleteQuestion = async function(cat, id) {
      await deleteDoc(doc(db, cat, id));
      alert("‚ùå ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      loadQuestions();
    };

    // View Results
    async function loadResults() {
      const table = document.getElementById("results-list");
      table.innerHTML = "<tr><td colspan='4'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";
      const snapshot = await getDocs(collection(db, "results"));
      let rows = "";
      snapshot.forEach(docSnap => {
        const r = docSnap.data();
        rows += `
          <tr>
            <td>${r.email}</td>
            <td>${r.exam}</td>
            <td>${r.score}/${r.total}</td>
            <td>${new Date(r.submittedAt.seconds*1000).toLocaleString()}</td>
          </tr>
        `;
      });
      table.innerHTML = rows || "<tr><td colspan='4'>‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶®‡ßá‡¶á</td></tr>";
    }

    // Manage Users
    async function loadUsers() {
      const table = document.getElementById("users-list");
      table.innerHTML = "<tr><td colspan='2'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>";
      const snapshot = await getDocs(collection(db, "users"));
      let rows = "";
      snapshot.forEach(docSnap => {
        const u = docSnap.data();
        rows += `<tr><td>${u.email}</td><td>${u.name || "Unknown"}</td></tr>`;
      });
      table.innerHTML = rows || "<tr><td colspan='2'>‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</td></tr>";
    }
  </script>
  <style>
    body { background: linear-gradient(135deg,#0f2027,#203a43,#2c5364); color:white; font-family: 'Segoe UI', sans-serif; }
    .sidebar { background: linear-gradient(180deg,#1e3c72,#2a5298); transition: transform 0.3s ease; }
    .sidebar.hidden { transform: translateX(-100%); }
    .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); color:black; }
    .rainbow { background: linear-gradient(90deg,#ff7e5f,#feb47b,#ff6a00,#ee0979,#6a11cb,#2575fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight:bold; }
  </style>
</head>
<body class="h-screen flex overflow-hidden">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed md:static w-64 h-full text-white z-50 hidden md:block">
    <div class="p-5 text-center border-b border-white/20">
      <h1 class="rainbow text-2xl">üåà Target Zone</h1>
      <p id="admin-email" class="text-sm"></p>
    </div>
    <nav class="p-4 space-y-3">
      <button onclick="showSection('add')" class="w-full bg-white/20 py-2 rounded">‚ûï Add Question</button>
      <button onclick="showSection('manage')" class="w-full bg-white/20 py-2 rounded">üìÇ Manage Questions</button>
      <button onclick="showSection('results')" class="w-full bg-white/20 py-2 rounded">üìä View Results</button>
      <button onclick="showSection('users')" class="w-full bg-white/20 py-2 rounded">üë• Manage Users</button>
    </nav>
    <div class="p-4 border-t border-white/20">
      <button onclick="logout()" class="w-full bg-red-600 py-2 rounded">üö™ Logout</button>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
      <button id="menu-btn" class="md:hidden bg-yellow-400 px-3 py-2 rounded">‚ò∞</button>
      <h2 class="rainbow text-3xl">üõ†Ô∏è Admin Panel</h2>
      <audio id="bg-music" controls autoplay loop class="w-40">
        <source src="YOUR_SONG_LINK_HERE.mp3" type="audio/mp3">
      </audio>
    </div>

    <!-- Sections -->
    <section id="section-add" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">‚ûï Add New Question</h3>
      <select id="category" class="w-full border rounded px-3 py-2 mb-3">
        <option value="ssc">SSC</option>
        <option value="railways">Railways</option>
        <option value="tet">TET</option>
      </select>
      <textarea id="question" rows="3" class="w-full border rounded px-3 py-2 mb-3" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      <input id="option1" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 1">
      <input id="option2" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 2">
      <input id="option3" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 3">
      <input id="option4" class="w-full border rounded px-3 py-2 mb-2" placeholder="Option 4">
      <input id="answer" class="w-full border rounded px-3 py-2 mb-3" placeholder="‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞">
      <button onclick="addQuestion()" class="w-full bg-blue-600 text-white py-2 rounded">üíæ Save Question</button>
    </section>

    <section id="section-manage" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üìÇ Manage Questions</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Category</th><th>Question</th><th>Answer</th><th>Edit</th><th>Delete</th></tr></thead>
        <tbody id="questions-list"></tbody>
      </table>
    </section>

    <section id="section-results" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üìä View Results</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Exam</th><th>Score</th><th>Submitted</th></tr></thead>
        <tbody id="results-list"></tbody>
      </table>
    </section>

    <section id="section-users" class="glass p-6 rounded-lg shadow-lg hidden">
      <h3 class="text-xl font-bold mb-4">üë• Manage Users</h3>
      <table class="w-full text-left border">
        <thead><tr><th>Email</th><th>Name</th></tr></thead>
        <tbody id="users-list"></tbody>
      </table>
    </section>
  </main>

  <script>
    const sections=["add","manage","results","users"];
    window.showSection=function(id){
      sections.forEach(sec=>document.getElementById("section-"+sec).classList.add("hidden"));
      document.getElementById("section-"+id).classList.remove("hidden");
    };
    document.getElementById("menu-btn").addEventListener("click",()=>{document.getElementById("sidebar").classList.toggle("hidden");});
  </script>
</body>
</html>
