<!DOCTYPE html><html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Target Zone - Signup</title>

  <!-- Tailwind & SweetAlert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* ---- Dreamy sky background (scroll enabled) ---- */
    body{
      font-family:'Segoe UI',sans-serif;
      min-height:100vh;
      background:linear-gradient(to bottom,#a1c4fd,#c2e9fb);
      background-attachment:fixed;
      overflow-x:hidden;
      padding:24px 12px;
      position:relative;
    }

    /* ---- Floating clouds ---- */
    .cloud{
      position:absolute;background:#fff;border-radius:50%;opacity:.6;
      animation:float linear infinite; box-shadow:40px 20px 60px rgba(0,0,0,.08);
    }
    .cloud.one{width:220px;height:68px;top:12%;left:-260px;animation-duration:60s}
    .cloud.two{width:170px;height:56px;top:36%;left:-220px;animation-duration:85s}
    .cloud.three{width:280px;height:78px;top:60%;left:-320px;animation-duration:105s}
    @keyframes float{from{transform:translateX(0)}to{transform:translateX(120vw)}}

    /* ---- Left illustration (student) ---- */
    .student{
      width: 18rem; max-width: 45vw;
      animation:bounce 5s ease-in-out infinite;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,.15));
    }
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-18px)}}

    /* ---- Glassy form container ---- */
    .glass{
      background:rgba(255,255,255,.78);
      backdrop-filter:blur(12px);
      -webkit-backdrop-filter:blur(12px);
      border-radius:1.5rem;
      box-shadow:0 20px 50px rgba(0,0,0,.18);
      transition:.25s ease;
    }
    .glass:hover{background:rgba(255,255,255,.92);transform:translateY(-2px)}

    /* ---- Inputs: semi-transparent + focus glow ---- */
    .t-input{
      background:rgba(255,255,255,.65)!important;
      border:1px solid rgba(0,0,0,.12);
      transition:.25s;
    }
    .t-input:focus{
      background:rgba(255,255,255,.95)!important;
      border-color:#4facfe;
      box-shadow:0 0 0 4px rgba(79,172,254,.25);
      outline:none;
    }

    /* ---- Validation helper ---- */
    .input-error{border-color:#f87171!important; box-shadow:0 0 0 3px rgba(248,113,113,.2)}

    /* ---- Calendar icon in DOB ---- */
    .dob-wrap{position:relative}
    .dob-icon{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      cursor:pointer; opacity:.85;
    }
    .dob-icon svg{width:22px; height:22px}
  </style>
</head>
<body>
  <!-- Background clouds -->
  <div class="cloud one"></div>
  <div class="cloud two"></div>
  <div class="cloud three"></div>

  <!-- Page content: 2-column on md+  -->
  <div class="w-full max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10 items-start">
    <!-- LEFT: illustration area (keeps your side design visible) -->
    <div class="flex justify-center md:justify-start">
      <!-- smiling student (put student.png in same folder) -->
      <img src="student.png" alt="Smiling Student" class="student mt-6 md:mt-12">
    </div>

    <!-- RIGHT: Signup Form (glassy card, not full page) -->
    <div class="glass p-6 md:p-8">
      <h2 class="text-3xl font-extrabold text-center mb-6 bg-gradient-to-r from-blue-600 to-indigo-500 bg-clip-text text-transparent">
        üéØ Target Zone - Signup Form
      </h2>

      <form id="signupForm" class="grid grid-cols-1 gap-4" enctype="multipart/form-data" novalidate>
        <!-- Name -->
        <input type="text" id="name" required
               placeholder="üë§ Full Name *"
               class="t-input px-4 py-3 rounded-lg shadow-sm">

        <!-- WhatsApp -->
        <input type="tel" id="whatsapp" required
               placeholder="üì± WhatsApp Number *"
               class="t-input px-4 py-3 rounded-lg shadow-sm">

        <!-- Email -->
        <input type="email" id="email" required
               placeholder="üìß Email *"
               class="t-input px-4 py-3 rounded-lg shadow-sm">

        <!-- DOB (manual + calendar icon) -->
        <div class="dob-wrap">
          <input type="text" id="dob" required
                 inputmode="numeric"
                 placeholder="üìÖ __/__/20__"
                 class="t-input w-full px-4 py-3 rounded-lg shadow-sm"
                 aria-describedby="dobHelp">
          <span class="dob-icon" id="dobIcon" title="Pick from calendar">
            <!-- inline SVG calendar icon (always visible) -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="1.75"></rect>
              <line x1="16" y1="2.5" x2="16" y2="6" stroke-width="1.75"></line>
              <line x1="8" y1="2.5" x2="8" y2="6" stroke-width="1.75"></line>
              <line x1="3" y1="10" x2="21" y2="10" stroke-width="1.75"></line>
            </svg>
          </span>
          <p id="dobHelp" class="text-xs text-gray-600 mt-1">Format: DD/MM/20YY (‡¶¨‡¶æ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ‡¶ì)‡•§</p>
        </div>

        <!-- Password -->
        <div>
          <input type="password" id="password" required
                 placeholder="üîê Password *"
                 class="t-input w-full px-4 py-3 rounded-lg shadow-sm">
          <p class="text-xs text-gray-600 mt-1">
            Must be 8+ chars, include uppercase, lowercase, number & symbol.
          </p>
        </div>

        <!-- Education -->
        <select id="education" required class="t-input px-4 py-3 rounded-lg shadow-sm">
          <option value="">üéì Educational Qualification *</option>
          <option>Madhyamik</option>
          <option>HS</option>
          <option>Graduate</option>
          <option>Post Graduate</option>
          <option>Other</option>
        </select>

        <!-- Status -->
        <select id="status" required class="t-input px-4 py-3 rounded-lg shadow-sm">
          <option value="">üßë‚Äçüéì Current Status *</option>
          <option>Student</option>
          <option>Job Seeker</option>
          <option>Employed</option>
        </select>

        <!-- Auto UID (read-only) -->
        <input type="text" id="uid" class="t-input px-4 py-3 rounded-lg shadow-sm bg-white"
               placeholder="üÜî UID (Auto Generate)" readonly>

        <!-- Subscribe -->
        <label class="flex items-start gap-2 select-none">
          <input type="checkbox" id="subscribe" class="mt-1">
          <span class="text-sm">üîî I want to receive important updates and offers</span>
        </label>

        <!-- Terms -->
        <label class="flex items-start gap-2 select-none">
          <input type="checkbox" id="terms" required class="mt-1">
          <span class="text-sm">
            I agree to the <a href="terms.html" class="text-blue-600 underline" target="_blank">Terms and Conditions</a>.
          </span>
        </label>

        <!-- Submit -->
        <button id="submitBtn" type="submit"
                class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-600 text-white py-3 rounded-lg font-semibold text-lg transition-all">
          ‚úÖ Sign Up
        </button>

        <p id="message" class="text-center text-sm"></p>
      </form>

      <p class="text-center text-sm mt-6 text-gray-700">
        Already have an account?
        <a href="exam.html" class="text-blue-600 hover:underline">Login here</a>
      </p>
    </div>
  </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("signupForm");
    const uidField = document.getElementById("uid");
    const nameField = document.getElementById("name");
    const dobField  = document.getElementById("dob");
    const dobIcon   = document.getElementById("dobIcon");

    // Auto UID from name
    nameField.addEventListener("input", () => {
      const prefix = nameField.value.trim().charAt(0).toUpperCase() || "U";
      const serial = Math.floor(1000 + Math.random() * 9000);
      uidField.value = `${prefix}${serial}`;
    });

    // Validate required inputs
    const validateForm = () => {
      let valid = true;
      form.querySelectorAll("input[required], select[required], textarea[required]").forEach(input => {
        if (!input.value.trim() || (input.type==="checkbox" && !input.checked)) {
          input.classList.add("input-error");
          valid = false;
        } else {
          input.classList.remove("input-error");
        }
      });
      return valid;
    };

    // DOB: calendar icon => open native picker
    function openDatePicker(){
      const wasText = dobField.type === "text";
      dobField.type = "date";
      // Prefer native showPicker if available
      if (typeof dobField.showPicker === "function") {
        dobField.showPicker();
      } else {
        dobField.focus();
        dobField.click();
      }
      // If user cancels without picking, revert back on blur so placeholder shows
      if (wasText) {
        const revert = (e)=>{
          if (!dobField.value) dobField.type = "text";
          dobField.removeEventListener("blur", revert);
        };
        dobField.addEventListener("blur", revert);
      }
    }
    dobIcon.addEventListener("click", openDatePicker);

    // If user manually types DD/MM/20YY, keep as text; if they pick date, keep as date value.
    // Normalizing text input (optional light check)
    function normalizeDOBText(v){
      // Accept 1-2D / 1-2M / 20YY -> pad zeros
      const m = v.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](20\d{2})$/);
      if(!m) return v;
      const d = m[1].padStart(2,"0");
      const mo = m[2].padStart(2,"0");
      const y = m[3];
      return `${d}/${mo}/${y}`;
    }
    dobField.addEventListener("input", ()=>{
      if (dobField.type === "text") {
        dobField.value = normalizeDOBText(dobField.value);
      }
    });

    // Submit handler
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!validateForm()) {
        Swal.fire({ icon: 'error', title: 'Missing Fields', text: 'Please fill out all required fields.' });
        return;
      }

      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Processing...";

      const name = nameField.value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const education = document.getElementById("education").value;
      const status = document.getElementById("status").value;
      const uid = uidField.value;
      const subscribe = document.getElementById("subscribe").checked;

      // Read DOB as string (supports both text and date types)
      let dob = dobField.value;
      if (dobField.type === "date" && dob) {
        // store as ISO (YYYY-MM-DD) for consistency
        // dob is already YYYY-MM-DD in input[type=date]
      } else {
        // manual text like DD/MM/20YY
        dob = normalizeDOBText(dob);
      }

      try {
        await createUserWithEmailAndPassword(auth, email, password);

        await addDoc(collection(db, "users"), {
          uid,
          name,
          whatsapp,
          email,
          dob,               // <- store DOB
          education,
          status,
          subscribe,
          createdAt: serverTimestamp()
        });

        Swal.fire({
          icon: 'success',
          title: 'Signup Successful!',
          text: 'Redirecting to login...',
          timer: 3000,
          timerProgressBar: true,
          showConfirmButton: false
        }).then(() => {
          window.location.href = "exam.html";
        });
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Signup Failed', text: err.message });
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "‚úÖ Sign Up";
      }
    });
  </script>
</body>
</html>
